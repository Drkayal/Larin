#!/bin/bash

echo "๐ ุจุฏุก ุชุดุบูู ุจูุช ุงูููุณููู..."

# ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ
echo "๐ฆ ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ..."
source venv/bin/activate

# ุจุฏุก ุชุดุบูู PostgreSQL ุฅุฐุง ูู ููู ูุนูู
echo "๐๏ธ ุงูุชุญูู ูู ุญุงูุฉ PostgreSQL..."
if ! sudo service postgresql status > /dev/null 2>&1; then
    echo "โก ุจุฏุก ุชุดุบูู PostgreSQL..."
    sudo service postgresql start
fi

# ุงูุชุญูู ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช
echo "๐ ุงูุชุญูู ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช..."
if ! sudo -u postgres psql -d zemusic_bot -c "SELECT 1;" > /dev/null 2>&1; then
    echo "โ ูุดู ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช!"
    exit 1
fi

echo "โ PostgreSQL ูุนูู ุจูุฌุงุญ!"

# ุชุญููู ูุชุบูุฑุงุช ุงูุจูุฆุฉ
echo "๐ง ุชุญููู ูุชุบูุฑุงุช ุงูุจูุฆุฉ..."
set -a
source .env
set +a

# ุจุฏุก ุชุดุบูู ุงูุจูุช
echo "๐ต ุจุฏุก ุชุดุบูู ุงูุจูุช..."
python3 -m ZeMusic